<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitcoin Private Key â€“ 256â€‘bit Visual Grid</title>

  <!-- ðŸ’…  Darkâ€‘neumorphism styling -->
  <style>
    :root { --bit-size:24px;--gap-size:2px;--bg:#0e1116;--off:#1f2430;--on:#00c853;--border:#2b313c;--text:#e0e0e0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;letter-spacing:.02em }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center}
    h1{font-size:1.2rem;font-weight:600;margin:1.2rem 0 .8rem;opacity:.92}
    #grid{display:grid;grid-template-columns:repeat(16,var(--bit-size));grid-auto-rows:var(--bit-size);gap:var(--gap-size);background:var(--border);padding:var(--gap-size);border-radius:8px;box-shadow:0 0 0 2px var(--border)}
    .bit{width:var(--bit-size);height:var(--bit-size);background:var(--off);cursor:pointer;border-radius:2px;transition:background .15s}
    .bit.on{background:var(--on)}
    .controls{margin:1.2rem 0 .6rem;display:flex;gap:.9rem;flex-wrap:wrap;justify-content:center}
    button,select{all:unset;cursor:pointer;background:var(--off);padding:.55rem 1.4rem;border-radius:6px;font-size:.85rem;font-weight:500;box-shadow:0 0 0 1px var(--border);transition:background .15s}
    button:hover,select:hover{background:var(--border)}
    select{padding-right:2rem;appearance:none;position:relative}
    .field-wrapper{width:min(92vw,820px);margin:.4rem 0}
    .label{display:block;font-size:.78rem;opacity:.75;margin-bottom:.25rem}
    .value{user-select:all;word-break:break-all;padding:.55rem .7rem;border-radius:4px;background:#14171d;box-shadow:inset 0 0 0 1px var(--border);font-family:"JetBrains Mono",Consolas,monospace;font-size:.74rem;display:flex;align-items:center;flex-wrap:wrap;gap:.4rem}
    .balance{opacity:.85;font-size:.72rem}
    .value.funded{background:#162c1d;box-shadow:inset 0 0 0 1px var(--on),0 0 6px #00c85366}
  </style>
</head>
<body>
  <h1>256â€‘bit Privateâ€‘Key Visualiser</h1>
  <div id="grid" aria-label="bit matrix"></div>
  <div class="controls">
    <button id="btnClr">Clear</button>
    <button id="btnRand">Random</button>
    <select id="apiSelect" title="Balance API">
      <option value="mempool">mempool.space</option>
      <option value="blockchain">blockchain.info</option>
    </select>
  </div>

  <div class="field-wrapper"><span class="label">Private Key (Binary)</span><div id="bin" class="value"></div></div>
  <div class="field-wrapper"><span class="label">Private Key (HEX)</span><div id="hex" class="value"></div></div>
  <div class="field-wrapper"><span class="label">Wallet Import Format (WIF)</span><div id="wif" class="value"></div></div>
  <div class="field-wrapper"><span class="label">Bitcoin Address â€” compressed</span><div id="addrC" class="value"><span id="addrCtext"></span><span id="balC" class="balance"></span></div></div>
  <div class="field-wrapper"><span class="label">Bitcoin Address â€” uncompressed</span><div id="addrU" class="value"><span id="addrUtext"></span><span id="balU" class="balance"></span></div></div>

  <!-- ðŸ“¦  Crypto libs & balance lookup -->
  <script type="module">
    import { getPublicKey } from "https://cdn.jsdelivr.net/npm/@noble/secp256k1@2.3.0/+esm";
    import { sha256 } from "https://esm.sh/@noble/hashes@1.3.2/sha256";
    import { ripemd160 } from "https://esm.sh/@noble/hashes@1.3.2/ripemd160";
    import bs58 from "https://cdn.jsdelivr.net/npm/bs58@5.0.0/+esm";

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UI state */
    const bits = new Uint8Array(256);
    const grid = document.getElementById("grid");

    // build grid (topâ€‘left MSB 255)
    for (let row = 15; row >= 0; row--) {
      for (let col = 15; col >= 0; col--) {
        const i = row * 16 + col;
        const d = document.createElement("div");
        d.className = "bit";
        d.dataset.index = i;
        d.addEventListener("click", () => toggleBit(i, d));
        grid.appendChild(d);
      }
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DOM refs */
    const apiSelect = document.getElementById("apiSelect");
    let apiProvider = apiSelect.value;
    apiSelect.onchange = () => { apiProvider = apiSelect.value; recalc(); };

    const binField = document.getElementById("bin");
    const hexField = document.getElementById("hex");
    const wifField = document.getElementById("wif");
    const addrCElm = document.getElementById("addrCtext");
    const addrUElm = document.getElementById("addrUtext");
    const balCElm = document.getElementById("balC");
    const balUElm = document.getElementById("balU");
    const addrCBox = document.getElementById("addrC");
    const addrUBox = document.getElementById("addrU");

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ helpers */
    const toggleBit = (i, el) => { bits[i] ^= 1; el.classList.toggle("on", bits[i]); recalc(); };
    const bitsToHex = () => { const bin = [...bits].reverse().join(""); return BigInt("0b" + bin).toString(16).padStart(64, "0"); };
    const u8 = (...arrs) => { const len = arrs.reduce((n, a) => n + a.length, 0); const out = new Uint8Array(len); let off = 0; for (const a of arrs) { out.set(a, off); off += a.length; } return out; };
    const checksum = p => sha256(sha256(p)).slice(0, 4);
    const b58c = p => bs58.encode(u8(p, checksum(p)));

    async function fetchBalance(addr, balElm, wrapper) {
      balElm.textContent = "";
      wrapper.classList.remove("funded");
      let sats = 0;
      try {
        if (apiProvider === "blockchain") {
          const rand = Math.random();
          const resp = await fetch(`https://blockchain.info/q/getreceivedbyaddress/${addr}?r=${rand}`);
          if (!resp.ok) throw new Error();
          sats = Number((await resp.text()).trim()) || 0;
        } else {
          const resp = await fetch(`https://mempool.space/api/address/${addr}`);
          if (!resp.ok) throw new Error();
          const data = await resp.json();
          sats = data.chain_stats?.funded_txo_sum ?? 0;
        }
      } catch (e) {
        /* network / rateâ€‘limit error â†’ leave sats = 0 */
      }
      if (sats > 0) {
        const btc = (sats / 1e8).toFixed(8);
        balElm.textContent = `${btc} BTC`;
        wrapper.classList.add("funded");
      }
    }

    function recalc() {
      const hex = bitsToHex();
      const pk = Uint8Array.from(hex.match(/.{2}/g).map(b => parseInt(b, 16)));
      if (pk.every(b => b === 0)) {
        binField.textContent = [...bits].reverse().join("");
        hexField.textContent = hex;
        wifField.textContent = "â€”";
        addrCElm.textContent = addrUElm.textContent = "â€”";
        balCElm.textContent = balUElm.textContent = "";
        addrCBox.classList.remove("funded");
        addrUBox.classList.remove("funded");
        return;
      }

      const pubC = getPublicKey(pk, true);
      const pubU = getPublicKey(pk, false);
      const hashC = ripemd160(sha256(pubC));
      const hashU = ripemd160(sha256(pubU));
      const addrC = b58c(u8(new Uint8Array([0x00]), hashC));
      const addrU = b58c(u8(new Uint8Array([0x00]), hashU));
      const wif   = b58c(u8(new Uint8Array([0x80]), pk, new Uint8Array([0x01])));

      binField.textContent = [...bits].reverse().join("");
      hexField.textContent = hex;
      wifField.textContent = wif;
      addrCElm.textContent = addrC;
      addrUElm.textContent = addrU;

      fetchBalance(addrC, balCElm, addrCBox);
      fetchBalance(addrU, balUElm, addrUBox);
    }

    /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ random & clear */
    document.getElementById("btnRand").onclick = () => {
      const rnd = new Uint8Array(32);
      crypto.getRandomValues(rnd);
      for (let i = 0; i < 256; i++) bits[i] = (rnd[Math.floor(i / 8)] >> (i % 8)) & 1;
      document.querySelectorAll(".bit").forEach(el => el.classList.toggle("on", bits[el.dataset.index]));
      recalc();
    };

    document.getElementById("btnClr").onclick = () => {
      bits.fill(0);
      document.querySelectorAll(".bit").forEach(el => el.classList.remove("on"));
      recalc();
    };

    recalc();
  </script>
</body>
</html>
