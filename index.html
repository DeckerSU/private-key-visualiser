<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bitcoin Private Key â€“ 256â€‘bit Visual Grid</title>

  <!-- ðŸ’…  Darkâ€‘neumorphism styling -->
  <style>
    :root{--bit-size:24px;--gap-size:2px;--bg:#0e1116;--off:#1f2430;--on:#00c853;--border:#2b313c;--text:#e0e0e0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;letter-spacing:.02em}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);display:flex;flex-direction:column;align-items:center}
    h1{font-size:1.2rem;font-weight:600;margin:1.2rem 0 .8rem;opacity:.92}

    /* bitâ€‘grid */
    #grid{display:grid;grid-template-columns:repeat(16,var(--bit-size));grid-auto-rows:var(--bit-size);gap:var(--gap-size);background:var(--border);padding:var(--gap-size);border-radius:8px;box-shadow:0 0 0 2px var(--border)}
    .bit{width:var(--bit-size);height:var(--bit-size);background:var(--off);cursor:pointer;border-radius:2px;transition:background .15s}
    .bit.on{background:var(--on)}

    /* controls */
    .controls{margin:1.2rem 0 .6rem;display:flex;gap:.9rem;flex-wrap:wrap;justify-content:center}
    button,select{all:unset;cursor:pointer;background:var(--off);padding:.55rem 1.4rem;border-radius:6px;font-size:.85rem;font-weight:500;box-shadow:0 0 0 1px var(--border);transition:background .15s}
    button:hover,select:hover{background:var(--border)}
    select{padding-right:2rem;appearance:none;position:relative}

    /* API row */
    .api-row{display:flex;align-items:center;gap:.6rem;margin-bottom:.8rem}
    .api-label{font-size:.8rem;opacity:.8}

    /* output fields */
    .field-wrapper{width:min(92vw,820px);margin:.4rem 0}
    .label{display:block;font-size:.78rem;opacity:.75;margin-bottom:.25rem}
    .value{padding:0;border-radius:4px;background:#14171d;box-shadow:inset 0 0 0 1px var(--border);font-family:"JetBrains Mono",Consolas,monospace;font-size:.74rem;display:flex;align-items:stretch;overflow:hidden}
    .addr{flex:1;padding:.55rem .7rem;overflow-wrap:anywhere;user-select:all}
    .balance{display:flex;align-items:center;justify-content:center;padding:.55rem .9rem;font-size:.72rem;white-space:nowrap;border-left:1px dotted var(--border)}
    .value.funded .balance{background:#00c853;color:#0e1116;font-weight:600}
    .value.error  .balance{background:#c62828;color:#fff;font-weight:600}
  </style>
</head>
<body>
  <h1>256â€‘bit Privateâ€‘Key Visualiser</h1>

  <div id="grid" aria-label="bit matrix"></div>

  <div class="controls">
    <button id="btnClr">Clear</button>
    <button id="btnRand">Random</button>
  </div>
  <div class="api-row">
    <span class="api-label">Blockchain Data API:</span>
    <select id="apiSelect" title="Balance API">
      <option value="mempool">mempool.space</option>
      <option value="blockchain" selected>blockchain.info</option>
    </select>
  </div>

  <div class="field-wrapper"><span class="label">Private Key (Binary)</span><div id="bin" class="value"></div></div>
  <div class="field-wrapper"><span class="label">Private Key (HEX)</span><div id="hex" class="value"></div></div>
  <div class="field-wrapper"><span class="label">Wallet Import Format (WIF)</span><div id="wif" class="value"></div></div>
  <div class="field-wrapper"><span class="label">BTC address (compressed)</span><div id="addrC" class="value"><span id="addrCtext" class="addr"></span><span id="balC" class="balance">0.00000000 BTC</span></div></div>
  <div class="field-wrapper"><span class="label">Bitcoin Address</span><div id="addrU" class="value"><span id="addrUtext" class="addr"></span><span id="balU" class="balance">0.00000000 BTC</span></div></div>

  <!-- ðŸ“¦  Crypto logic -->
  <script type="module">
    import { getPublicKey } from "https://cdn.jsdelivr.net/npm/@noble/secp256k1@2.3.0/+esm";
    import { sha256 }       from "https://esm.sh/@noble/hashes@1.3.2/sha256";
    import { ripemd160 }    from "https://esm.sh/@noble/hashes@1.3.2/ripemd160";
    import bs58             from "https://cdn.jsdelivr.net/npm/bs58@5.0.0/+esm";

    /* â”€â”€ state & DOM refs */
    const bits = new Uint8Array(256);
    const grid = document.getElementById("grid");

    const apiSelect = document.getElementById("apiSelect");
    let apiProvider = apiSelect.value;
    apiSelect.onchange = () => { apiProvider = apiSelect.value; recalc(); };

    const binField = document.getElementById("bin");
    const hexField = document.getElementById("hex");
    const wifField = document.getElementById("wif");
    const addrCElm = document.getElementById("addrCtext");
    const addrUElm = document.getElementById("addrUtext");
    const balCElm  = document.getElementById("balC");
    const balUElm  = document.getElementById("balU");
    const addrCBox = document.getElementById("addrC");
    const addrUBox = document.getElementById("addrU");

    /* â”€â”€ build 16Ã—16 interactive grid */
    for (let row = 15; row >= 0; row--) {
      for (let col = 15; col >= 0; col--) {
        const i = row * 16 + col;
        const d = document.createElement("div");
        d.className = "bit";
        d.dataset.index = i;
        d.addEventListener("click", () => toggleBit(i, d));
        grid.appendChild(d);
      }
    }

    /* helpers */
    const toggleBit = (i, el) => { bits[i] ^= 1; el.classList.toggle("on", bits[i]); recalc(); };
    const bitsToHex = () => {
      const binStr = Array.from(bits).reverse().join("");
      return BigInt("0b" + binStr).toString(16).padStart(64, "0");
    };
    const concatU8 = (...arrs) => {
      const len = arrs.reduce((n,a)=>n+a.length,0);
      const out = new Uint8Array(len);
      let off=0; for(const a of arrs){out.set(a,off); off+=a.length;} return out;
    };
    const checksum = p => sha256(sha256(p)).slice(0,4);
    const base58c  = p => bs58.encode(concatU8(p, checksum(p)));

    async function fetchBalance(addr, balElm, wrapper){
      balElm.textContent = "0.00000000 BTC";
      wrapper.classList.remove("funded","error");
      let sats = 0, err = false;
      try{
        if(apiProvider === "blockchain"){
          const resp = await fetch(`https://blockchain.info/q/getreceivedbyaddress/${addr}?r=${Math.random()}`);
          if(!resp.ok) throw 0;
          sats = Number((await resp.text()).trim()) || 0;
        }else{
          const resp = await fetch(`https://mempool.space/api/address/${addr}?r=${Math.random()}`);
          if(!resp.ok) throw 0;
          const data = await resp.json();
          sats = data.chain_stats?.funded_txo_sum ?? 0;
        }
      }catch{ err = true; }
      balElm.textContent = (sats/1e8).toFixed(8) + " BTC";
      if(err){ wrapper.classList.add("error"); }
      else if(sats>0){ wrapper.classList.add("funded"); }
    }

    function recalc(){
      const hex = bitsToHex();
      const pk  = Uint8Array.from(hex.match(/.{2}/g).map(h=>parseInt(h,16)));
      // update common fields
      binField.textContent = Array.from(bits).reverse().join("");
      hexField.textContent = hex;

      // zero key guard
      if(pk.every(b=>b===0)){
        wifField.textContent = "â€”";
        addrCElm.textContent = addrUElm.textContent = "â€”";
        balCElm.textContent = balUElm.textContent = "0.00000000 BTC";
        addrCBox.classList.remove("funded","error");
        addrUBox.classList.remove("funded","error");
        return;
      }

      const pubC  = getPublicKey(pk,true);
      const pubU  = getPublicKey(pk,false);
      const hashC = ripemd160(sha256(pubC));
      const hashU = ripemd160(sha256(pubU));
      const addrC = base58c(concatU8(new Uint8Array([0x00]), hashC));
      const addrU = base58c(concatU8(new Uint8Array([0x00]), hashU));
      const wif   = base58c(concatU8(new Uint8Array([0x80]), pk, new Uint8Array([0x01])));

      wifField.textContent = wif;
      addrCElm.textContent = addrC;
      addrUElm.textContent = addrU;

      fetchBalance(addrC, balCElm, addrCBox);
      fetchBalance(addrU, balUElm, addrUBox);
    }

    /* random & clear */
    document.getElementById("btnRand").onclick = () => {
      const rndBytes = new Uint8Array(32);
      crypto.getRandomValues(rndBytes);
      for(let i=0;i<256;i++) bits[i] = (rndBytes[Math.floor(i/8)]>>(i%8)) & 1;
      document.querySelectorAll(".bit").forEach(el=>el.classList.toggle("on", bits[el.dataset.index]));
      recalc();
    };

    document.getElementById("btnClr").onclick = () => {
      bits.fill(0);
      document.querySelectorAll(".bit").forEach(el=>el.classList.remove("on"));
      recalc();
    };

    /* initial render */
    recalc();
  </script>
</body>
</html>
